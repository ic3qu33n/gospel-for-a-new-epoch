[bits 64]

section .data

;x64 syscall reference

SYS_READ 		equ 0x0
SYS_WRITE 		equ 0x1
SYS_OPEN 		equ 0x2
SYS_CLOSE 		equ 0x3
SYS_EXIT		equ 0x3c
SYS_GETDENTS64	equ 0x4e

teststr:
	db 'boo',0x0a
teststrlen equ $-teststr

framebuffer:
	db '///dev///fb0\x00'
framebuflen equ $-framebuffer
;;
STDOUT			db 0x1


;open() syscall parameter reference 
OPEN_RW			db 0x2
O_RDONLY		db 0x0

struc linux_dirent
	.d_ino			resq 1
	.d_off			resq 1
	.d_reclen		resw 1
	.d_nameq		resb 1
endstruc

;MAX_RDENT_BUF:	db 0x200 dup (?)
MAX_RDENT_BUF	dw 0x200

;;file pointed to by fstat is fd
struc file_stat
	.st_de			resq 1	;ID of dev containing file
	.st_ino			resq 1	;inode #
	.st_mode		resq 1	;protection
	.st_nlink		resq 1	;# of hard links
	.st_uid			resq 1	;user id of owner
	.st_gid			resq 1	;group Id of owner
	.st_rdev		resq 1 	;dev ID 
	.st_size		resq 1	;total size in bytes
	.st_blksize		resq 1	; blocksize for fs i/o
	.st_blocks		resq 1	;# of 512b blocks allocated
	.st_atime		resq 1	;time of last file access
	.st_mtime		resq 1	;time of last file mod
	.st_ctime		resq 1	;time of last file status changea
endstruc

section .text
global _start
; getdents64 - syscall 0x4e
;; getdents(unsigned int fd, struct linux_dirent *dirent, unsigned int count);
;;rdi == fd
;;rsi == *dirent
;rdx == count
_start:
	push rbp
	mov rbp, rsp
	sub rsp, 600
	mov r14, rsp

	_getdirents:
;****************************************************************************************
; open - syscall 0x2
;;open(filename, flags, mode);
;;rdi == filename
;;rsi == flags
;rdx == mode
;; returns: fd (in rax, obv)
;****************************************************************************************
;	push "."
;	pop rdi
;	xor rsi, rsi 		;no flags
;	mov rdx, O_RDONLY	;open read-only
;	mov rax, SYS_OPEN
;	syscall
;	
;	mov r9, rax
;****************************************************************************************
	
;****************************************************************************************
;	push r9
;	pop rdi
;	lea rsi, [r14 + 200] ;r14 + 200 is location on the stack where we'll save our dirent struct
;	mov rdx, MAX_RDENT_BUF
;	mov rax, SYS_GETDENTS64
;	syscall


;	mov r8, rax
;****************************************************************************************
; close - syscall 0x3
;;close(fd);
;;rdi == fd (file descriptor)
;; returns: 0 on success (-1 on error)
;****************************************************************************************

;	push r9
;	pop rdi
;	mov rax, SYS_CLOSE
;	syscall

;****************************************************************************************
; write - syscall 0x1
;;rdi == fd (file descriptor)
;;rsi == const char* buf
;rdx == count (# of bytes to write)
;; returns: 0 on success (-1 on error)
;****************************************************************************************
		call paint
		skullbitmap:
			db 0x85,0x7e,0x7b,0x7b,0x79,0x76,0x73,0x71,0x6d,0x6a,0x69,0x66,0x64,0x63,0x61,0x5f,0x5d,0x5c,0x5b,0x5a,0x5a,0x59,0x57,0x56,0x55,0x55,0x54,0x54,0x55,0x55,0x54,0x55,0x57,0x5b,0x60,0x66,0x77,0x7f,0x75,0x71,0x6f,0x6e,0x6c,0x6b,0x6b,0x6c,0x6f,0x73,0x76,0x78,0x7a,0x7d,0x7f,0x82,0x85,0x86,0x89,0x8d,0x8f,0x92,0x94,0x97,0x98,0x9a,0x0a
			db 0x77,0x72,0x70,0x70,0x6d,0x6a,0x67,0x64,0x62,0x5f,0x5d,0x5b,0x59,0x57,0x56,0x54,0x52,0x51,0x50,0x4f,0x4e,0x4d,0x4c,0x4b,0x4b,0x4b,0x4b,0x4b,0x4c,0x4e,0x52,0x5d,0x5e,0x58,0x55,0x54,0x57,0x56,0x53,0x52,0x52,0x54,0x57,0x5b,0x5f,0x65,0x6a,0x6a,0x6a,0x6d,0x6f,0x71,0x75,0x7a,0x7c,0x7e,0x81,0x85,0x88,0x8a,0x8c,0x8e,0x8f,0x8f
			db 0x6a,0x65,0x63,0x64,0x61,0x5e,0x5c,0x5a,0x57,0x54,0x53,0x52,0x50,0x4e,0x4c,0x4a,0x48,0x46,0x45,0x44,0x43,0x42,0x41,0x40,0x41,0x44,0x47,0x48,0x46,0x46,0x46,0x45,0x42,0x40,0x41,0x44,0x49,0x4e,0x4f,0x58,0x5b,0x56,0x58,0x58,0x58,0x59,0x5b,0x5c,0x5c,0x5d,0x5f,0x61,0x64,0x66,0x68,0x6b,0x6e,0x71,0x75,0x7b,0x7f,0x83,0x86,0x8c
			db 0x5e,0x5b,0x59,0x5a,0x57,0x54,0x52,0x50,0x4d,0x4b,0x4a,0x4a,0x47,0x44,0x42,0x40,0x3d,0x3c,0x3a,0x3a,0x39,0x39,0x3a,0x3d,0x3f,0x3d,0x39,0x36,0x36,0x37,0x3c,0x40,0x4a,0x57,0x64,0x65,0x5d,0x4f,0x43,0x48,0x49,0x42,0x43,0x44,0x45,0x47,0x48,0x4a,0x4c,0x4e,0x50,0x53,0x56,0x58,0x5b,0x5d,0x60,0x64,0x67,0x6b,0x6e,0x71,0x75,0x7b
			db 0x54,0x51,0x4f,0x50,0x4d,0x49,0x46,0x44,0x42,0x40,0x3f,0x3d,0x3a,0x38,0x36,0x35,0x33,0x32,0x32,0x32,0x36,0x37,0x36,0x32,0x2e,0x2e,0x34,0x40,0x4b,0x5c,0x6c,0x74,0x77,0x67,0x57,0x3c,0x33,0x36,0x3f,0x46,0x3a,0x39,0x3b,0x3c,0x3d,0x3f,0x41,0x40,0x42,0x44,0x46,0x49,0x4b,0x4e,0x4f,0x52,0x55,0x58,0x5b,0x5e,0x62,0x65,0x6a,0x6f
			db 0x4a,0x47,0x46,0x48,0x43,0x40,0x3d,0x3b,0x39,0x37,0x36,0x34,0x31,0x2e,0x2d,0x2d,0x2b,0x2b,0x30,0x38,0x2f,0x29,0x27,0x27,0x37,0x62,0x7e,0x80,0x72,0x62,0x5a,0x50,0x38,0x2c,0x2b,0x2a,0x2a,0x39,0x37,0x36,0x2e,0x2d,0x2e,0x30,0x31,0x33,0x35,0x35,0x38,0x39,0x3d,0x44,0x42,0x43,0x47,0x49,0x4a,0x4e,0x52,0x54,0x57,0x5a,0x5f,0x65
			db 0x41,0x3e,0x3d,0x3f,0x3a,0x37,0x35,0x33,0x30,0x2e,0x2e,0x2b,0x28,0x27,0x26,0x26,0x28,0x2f,0x34,0x2c,0x22,0x26,0x3c,0x5b,0x79,0x75,0x72,0x65,0x49,0x3a,0x35,0x34,0x2b,0x29,0x29,0x2d,0x37,0x4e,0x3c,0x31,0x25,0x25,0x26,0x27,0x29,0x2a,0x2c,0x2d,0x2f,0x31,0x36,0x4d,0x3e,0x39,0x3c,0x3e,0x41,0x45,0x48,0x4a,0x4c,0x4f,0x56,0x5a
			db 0x37,0x34,0x34,0x36,0x31,0x2e,0x2c,0x29,0x27,0x27,0x27,0x26,0x23,0x22,0x21,0x29,0x2f,0x24,0x1f,0x2b,0x4c,0x6f,0x72,0x62,0x55,0x4b,0x40,0x33,0x29,0x27,0x27,0x27,0x27,0x27,0x29,0x2b,0x29,0x38,0x28,0x22,0x20,0x21,0x21,0x22,0x23,0x24,0x25,0x27,0x39,0x49,0x40,0x47,0x30,0x32,0x35,0x35,0x38,0x3c,0x3e,0x42,0x44,0x49,0x50,0x53
			db 0x2f,0x2c,0x2d,0x2d,0x28,0x27,0x24,0x22,0x21,0x21,0x21,0x1f,0x1d,0x1d,0x2a,0x2c,0x1b,0x20,0x4b,0x6a,0x4e,0x31,0x22,0x22,0x20,0x19,0x16,0x14,0x15,0x15,0x15,0x17,0x18,0x19,0x18,0x17,0x19,0x26,0x19,0x1a,0x1c,0x1d,0x1e,0x1f,0x1f,0x1f,0x25,0x39,0x4a,0x32,0x25,0x26,0x28,0x2a,0x2e,0x2e,0x31,0x34,0x37,0x3a,0x3d,0x42,0x48,0x4d
			db 0x27,0x25,0x26,0x26,0x22,0x20,0x1e,0x1d,0x1b,0x1b,0x1b,0x1a,0x18,0x2b,0x30,0x19,0x23,0x81,0x6e,0x2e,0x1d,0x16,0x13,0x14,0x13,0x12,0x11,0x12,0x12,0x12,0x12,0x14,0x13,0x12,0x13,0x13,0x13,0x20,0x16,0x15,0x15,0x17,0x1a,0x27,0x3b,0x40,0x43,0x40,0x21,0x1d,0x1e,0x1f,0x22,0x24,0x26,0x28,0x2a,0x2c,0x2f,0x33,0x36,0x3a,0x3f,0x45
			db 0x22,0x1f,0x21,0x1f,0x1c,0x1a,0x19,0x19,0x18,0x17,0x17,0x17,0x22,0x4c,0x1f,0x16,0x80,0x94,0x46,0x20,0x13,0xf,0xf,0x10,0x11,0x11,0x10,0xf,0x10,0x10,0xf,0xf,0x10,0x10,0x12,0x13,0x12,0x1a,0x15,0x13,0x18,0x1f,0x1d,0x1c,0x23,0x45,0x24,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1e,0x20,0x22,0x25,0x26,0x29,0x2c,0x2f,0x33,0x37,0x3c
			db 0x1c,0x1b,0x1c,0x1a,0x17,0x16,0x15,0x14,0x15,0x15,0x15,0x1a,0x3a,0x1f,0x13,0x54,0xad,0x72,0x42,0x14,0xd,0xc,0xc,0xd,0xe,0xf,0xe,0xd,0xd,0xd,0xd,0xd,0xf,0x1a,0x22,0x20,0x18,0x22,0x25,0x28,0x21,0x18,0x10,0x19,0x45,0x33,0x18,0x13,0x15,0x16,0x17,0x16,0x18,0x1a,0x1c,0x1e,0x1f,0x21,0x24,0x27,0x2a,0x2e,0x33,0x37
			db 0x17,0x17,0x19,0x16,0x15,0x13,0x11,0x10,0x10,0x11,0x10,0x1f,0x3c,0xd,0x10,0x98,0x9a,0x61,0x25,0xa,0x9,0xa,0xb,0xb,0xb,0xb,0xb,0xc,0xd,0xc,0xd,0x15,0x17,0x29,0x2f,0x27,0x3f,0x51,0x38,0x25,0x1b,0x19,0x24,0x29,0x49,0x13,0xf,0xf,0x10,0x12,0x14,0x14,0x14,0x17,0x18,0x1a,0x1c,0x1e,0x20,0x22,0x26,0x2a,0x30,0x34
			db 0x13,0x13,0x16,0x14,0x11,0xf,0xe,0xe,0xd,0xd,0xc,0x1a,0x2d,0xb,0x1a,0x9f,0x81,0x48,0x13,0xc,0x8,0x8,0xa,0xa,0x9,0x9,0x9,0xa,0xb,0xb,0xe,0x19,0x1b,0x46,0x55,0x3c,0x3f,0x3b,0x1b,0x19,0x17,0x17,0x20,0x17,0x13,0xe,0xe,0xd,0xd,0xe,0x10,0x11,0x11,0x14,0x15,0x17,0x19,0x1a,0x1c,0x1e,0x23,0x27,0x2b,0x30
			db 0x10,0x11,0x13,0x10,0xe,0xd,0xc,0xc,0xb,0xb,0xa,0x23,0x37,0x15,0x1b,0xa4,0x8f,0x36,0x17,0xe,0xa,0x7,0x9,0xa,0x8,0x8,0x9,0x9,0x9,0xa,0x9,0x8,0x10,0x53,0x53,0x3b,0x27,0x12,0x9,0xb,0x10,0xb,0xa,0xb,0xa,0xa,0xb,0xb,0xb,0xc,0xd,0xf,0xf,0x11,0x14,0x14,0x17,0x18,0x1a,0x1b,0x1f,0x24,0x28,0x2c
			db 0xe,0xf,0x11,0xe,0xc,0xb,0xa,0xa,0xa,0xa,0xf,0x35,0x3f,0x1a,0xe,0x34,0x6c,0x65,0x4f,0x3c,0x2c,0x23,0x22,0x22,0x1d,0x18,0x18,0x17,0x1b,0x2b,0xd,0x8,0xa,0x2e,0x5c,0x64,0x55,0x32,0x1b,0x21,0x25,0x1c,0x13,0x10,0xe,0xa,0xa,0xa,0xa,0xa,0xb,0xc,0xc,0xe,0x10,0x12,0x13,0x16,0x17,0x18,0x1b,0x1f,0x24,0x2a
			db 0xc,0xe,0xe,0xc,0xa,0x9,0x8,0x9,0x9,0x8,0x1f,0x31,0x20,0x1e,0x15,0x1e,0x33,0x51,0x41,0x2e,0x1a,0x21,0x35,0x45,0x3b,0x2c,0x26,0x1e,0x22,0x65,0x21,0x7,0x7,0xc,0x2a,0x36,0x39,0x34,0x31,0x2b,0x24,0x18,0x1a,0x11,0x16,0x13,0xc,0xa,0x9,0x9,0xa,0xa,0xa,0xc,0xe,0xf,0x10,0x12,0x14,0x16,0x19,0x1d,0x22,0x27
			db 0xa,0xd,0xc,0xb,0x9,0x8,0x7,0x7,0x7,0x7,0x1f,0x33,0x27,0x15,0x2f,0x90,0xaa,0xb4,0xb0,0x96,0x5a,0x31,0x1e,0x13,0xe,0xd,0xd,0xb,0xf,0x5d,0x33,0x1e,0x8,0x5,0xa,0x1b,0x14,0x9,0x11,0x46,0x2c,0x19,0x23,0x21,0x17,0xe,0x8,0x7,0x7,0x7,0x8,0x9,0x9,0xa,0xb,0xd,0xe,0xf,0x12,0x14,0x16,0x1a,0x1f,0x25
			db 0x9,0xc,0xb,0x9,0x8,0x6,0x6,0x6,0x6,0x6,0xe,0x2c,0x31,0x44,0x70,0xb2,0xa5,0xa4,0x8f,0x97,0x51,0x12,0x6,0x6,0x7,0x8,0xa,0xa,0xa,0x37,0x54,0x6b,0x52,0x50,0x47,0x42,0x34,0x28,0x25,0x2a,0x2c,0x1f,0x25,0x1a,0xe,0x7,0x5,0x5,0x6,0x7,0x9,0x9,0x9,0xa,0xb,0xc,0xe,0xf,0x11,0x14,0x16,0x18,0x1c,0x23
			db 0x8,0xa,0x9,0x8,0x7,0x5,0x5,0x5,0x5,0x5,0x5,0x5,0xb,0x37,0x80,0x9d,0xa6,0x84,0x54,0x3a,0xc,0x1b,0x41,0x39,0x23,0x17,0x16,0x19,0x1e,0x23,0x39,0x60,0x77,0x6d,0x3d,0x2a,0x39,0x6c,0x67,0x14,0x7,0x8,0x1c,0x3a,0x1c,0x10,0xa,0x6,0x6,0x6,0x7,0x9,0x9,0xc,0xd,0xf,0x12,0x17,0x19,0x1d,0x21,0x24,0x24,0x2a
			db 0x7,0x8,0x7,0x6,0x5,0x5,0x5,0x5,0x8,0x11,0x12,0x1d,0x2d,0x42,0x70,0x80,0x6c,0x43,0x49,0x1d,0x4,0x12,0x75,0x2f,0x42,0x4e,0x3d,0x42,0x49,0x5c,0x32,0x56,0x81,0x5e,0x33,0x11,0x11,0x21,0x81,0x18,0x3,0x4,0x12,0x65,0x62,0x30,0x29,0x30,0x27,0x1b,0x12,0x14,0x13,0x14,0x14,0x11,0x11,0x14,0x15,0x1a,0x23,0x2d,0x26,0x28
			db 0x7,0x8,0x6,0x5,0x4,0x5,0x11,0x1d,0x28,0x27,0x1f,0x43,0x36,0x1a,0x14,0x15,0x1c,0x26,0x10,0x4,0x6,0x25,0x74,0x25,0xd,0xb,0x10,0x4a,0x60,0x7e,0x19,0x1c,0x58,0x28,0x2f,0xf,0x8,0x17,0x6f,0x60,0x53,0x49,0x60,0x62,0x25,0x39,0x1f,0x7,0xe,0x25,0x2c,0x1d,0xf,0xa,0x9,0x9,0xb,0xc,0xe,0x11,0x13,0x18,0x1d,0x22
			db 0x6,0x6,0x5,0x6,0x4,0x4,0x13,0x30,0x1b,0xc,0x24,0x44,0xd,0x3,0x9,0x13,0x19,0x20,0x18,0x7,0x5,0xb,0x1d,0x28,0x2e,0x25,0x25,0x27,0x4b,0x9a,0x59,0x33,0x3a,0x5c,0x4c,0x4e,0x2c,0x2d,0x20,0x37,0x4e,0x43,0x31,0x29,0x2c,0x28,0x42,0xa,0x2,0x4,0x20,0x3b,0x41,0x35,0x26,0x14,0xc,0xd,0xf,0x11,0x13,0x17,0x1c,0x20
			db 0x7,0x7,0x6,0x6,0x4,0x4,0x3,0x1b,0x4f,0x27,0xc,0x6,0x7,0x15,0x23,0x26,0x18,0x7c,0x9e,0x56,0x1d,0x5,0x1,0x2,0x4,0x4,0x1,0x13,0x33,0x4c,0x6d,0x59,0x45,0x6b,0x81,0x78,0x50,0x6c,0x65,0x4d,0x2d,0x36,0x59,0x6f,0x8c,0x76,0x73,0x3c,0x8,0x4,0x7,0x12,0x20,0x47,0x5f,0x4a,0x1b,0x12,0x11,0x10,0x12,0x15,0x19,0x1f
			db 0x7,0x6,0x5,0x5,0x4,0x3,0x5,0x28,0x61,0x14,0x3,0x5,0x11,0x24,0x14,0xd,0xb,0x8a,0x9b,0x85,0x83,0x40,0x1c,0x10,0xb,0x7,0x4,0x4,0xc,0x14,0x22,0x19,0x19,0x1f,0x24,0x2b,0x24,0x33,0x80,0x97,0x8b,0x82,0x6b,0x42,0x48,0x4b,0x29,0x2b,0x2e,0x6,0x4,0x6,0xa,0x11,0x39,0x49,0x43,0x29,0x18,0x16,0x17,0x16,0x1a,0x1e
			db 0x7,0x5,0x4,0x4,0x3,0x2,0x2,0xf,0x3a,0x32,0x22,0x1a,0xa,0x10,0x4,0x2,0x5,0x4e,0x73,0x80,0xb6,0xb6,0xb3,0x9d,0x88,0x7f,0x74,0x68,0x65,0x70,0x7a,0x1a,0x15,0x2d,0x34,0x19,0x1c,0x25,0x53,0x63,0x5d,0x48,0x20,0x1,0x0,0x2,0x9,0xb,0x38,0x1f,0x3,0x5,0x7,0x8,0xb,0x25,0x43,0x4e,0x45,0x42,0x40,0x36,0x2d,0x22
			db 0x8,0x6,0x5,0x4,0x3,0x2,0x2,0x7,0xe,0x15,0x2f,0x4b,0xc,0x3,0x2,0x1,0x2,0x2a,0x5d,0x59,0x86,0x94,0x91,0x87,0x78,0x6d,0x61,0x60,0x65,0x62,0x41,0x1c,0x32,0x2c,0x45,0x26,0xb,0x7,0x11,0xf,0x15,0x3f,0x3a,0x17,0x1,0x1,0x2,0xa,0x1f,0x4d,0x10,0x5,0x7,0x8,0xa,0xb,0xb,0x10,0x13,0x15,0x18,0x1f,0x2f,0x36
			db 0x9,0x7,0x6,0x5,0x3,0x3,0x2,0x2,0x2,0x3,0x4,0x27,0x4c,0x15,0x6,0xa,0xc,0xb,0x8,0x5,0x5,0x5,0x6,0x6,0x6,0x5,0x2,0x2,0x3,0x2,0x2,0x10,0x30,0x3,0x3,0x3,0x2,0x2,0x2,0x2,0xe,0x2b,0x8,0x20,0x1e,0x12,0x4,0x2,0x6,0x35,0x51,0xf,0x9,0xa,0xb,0xb,0xb,0xc,0xd,0xf,0x13,0x17,0x1b,0x22
			db 0xa,0x8,0x7,0x6,0x4,0x3,0x3,0x6,0xa,0x12,0x2b,0x63,0x85,0x71,0x5b,0x6f,0x69,0x59,0x5f,0x4d,0x38,0x31,0x27,0x24,0x25,0x28,0x1d,0x1e,0x1e,0x18,0x29,0x3d,0x23,0x3,0x2,0x2,0x2,0x3,0x9,0x11,0x25,0xb,0x3,0x11,0x39,0x42,0x3d,0x24,0x14,0xa,0x3f,0x36,0xa,0xa,0xb,0xc,0xc,0xd,0xf,0x11,0x14,0x19,0x1d,0x21
			db 0xb,0x9,0x8,0x7,0x6,0x5,0x5,0x2b,0x5f,0x5d,0x78,0x7a,0x7c,0x7c,0x68,0x86,0x7a,0x5c,0x4d,0x43,0x1e,0x23,0xc,0xc,0x12,0x1e,0x11,0x16,0x35,0x11,0x21,0x2e,0x18,0x10,0x11,0xf,0x14,0x21,0x19,0xe,0x6,0x2,0x5,0x2f,0x14,0x2b,0x29,0xf,0x1b,0x2e,0x4c,0x40,0x9,0x9,0xa,0xb,0xd,0xe,0x10,0x13,0x1b,0x23,0x29,0x35
			db 0xd,0xb,0xa,0x9,0x8,0x7,0x5,0xb,0x52,0x6d,0x74,0x64,0x67,0x75,0x73,0x5e,0x31,0x1d,0x26,0x49,0x5b,0x36,0x11,0x27,0x3d,0x2e,0x15,0x27,0x47,0x17,0xf,0x17,0x19,0x15,0xe,0x17,0x4b,0x26,0x3,0x2,0x2,0x3,0x1a,0x1b,0x3,0xe,0x47,0x9,0x5,0xb,0x1d,0xd,0x8,0x9,0xb,0xd,0xf,0x11,0x16,0x21,0x27,0x22,0x26,0x36
			db 0xf,0xd,0xc,0xb,0x9,0x8,0x7,0x2d,0x65,0x62,0x60,0x5b,0x5c,0x4b,0x4d,0x39,0x3a,0x74,0x71,0x57,0x6c,0xa6,0x80,0x47,0x28,0x20,0x2a,0x7e,0x42,0x7,0xa,0x4e,0x46,0x12,0xa,0x12,0x2b,0x48,0x12,0x3,0x3,0x12,0x26,0x4,0x4,0x6,0x2e,0x26,0xe,0xc,0xb,0xc,0xe,0x10,0x13,0x17,0x1d,0x25,0x2c,0x20,0x1c,0x20,0x27,0x2d
			db 0x12,0xf,0xe,0xd,0xb,0xb,0x1a,0x4d,0x72,0x60,0x67,0x58,0xf,0x19,0x62,0xc,0x1,0x68,0x73,0x1e,0x8,0x7d,0x58,0x8,0x7,0x7,0xb,0x7a,0x7c,0x26,0xa,0x4a,0x7e,0x2c,0x21,0x37,0x3a,0x2f,0x11,0x3,0xf,0x2a,0xc,0x4,0x4,0x5,0x10,0x21,0x1d,0x1c,0x1c,0x1a,0x1c,0x1d,0x1c,0x1c,0x1c,0x1c,0x1b,0x1c,0x20,0x25,0x2a,0x30
			db 0x16,0x13,0x11,0x10,0xf,0x3a,0x89,0x70,0x58,0x2f,0x3a,0x21,0x19,0x20,0x6c,0x40,0x27,0x5e,0x9a,0x4b,0x3c,0x80,0xaf,0x97,0x92,0x8b,0x8d,0xae,0x9c,0x51,0x2c,0x25,0x20,0x13,0x19,0x15,0xb,0x4,0x5,0x14,0x2b,0x11,0x4,0x5,0x5,0x6,0x7,0x8,0x9,0xb,0xd,0xe,0xf,0x12,0x14,0x16,0x18,0x1a,0x1d,0x21,0x25,0x2a,0x30,0x35
			db 0x1a,0x18,0x16,0x14,0x16,0x5d,0x94,0x81,0x7b,0x87,0xa0,0xaf,0xa6,0xa7,0xb5,0xaf,0xa2,0xac,0xb6,0xab,0xa1,0x8a,0xa3,0xaa,0x68,0x61,0x43,0x3d,0x50,0xa,0x4,0x4,0x4,0x4,0x5,0x5,0x5,0x6,0x17,0x27,0xd,0x7,0x7,0x8,0x9,0xa,0xb,0xb,0xc,0xe,0xf,0x11,0x13,0x15,0x17,0x1a,0x1d,0x1f,0x23,0x26,0x2a,0x30,0x35,0x3b
			db 0x20,0x1d,0x1b,0x1a,0x21,0x80,0x74,0x4a,0x45,0x61,0x36,0x95,0x52,0x34,0x9f,0x57,0x23,0x98,0xa5,0x23,0x12,0x15,0x7d,0xb1,0x4c,0x22,0x1b,0x31,0x72,0x15,0x6,0x6,0x6,0x7,0x8,0xa,0xe,0x1f,0x3b,0x15,0xc,0xa,0xb,0xb,0xc,0xd,0xe,0xf,0x11,0x13,0x14,0x16,0x18,0x1a,0x1c,0x1f,0x22,0x25,0x28,0x2b,0x2f,0x34,0x3b,0x41
			db 0x26,0x23,0x22,0x20,0x25,0x5e,0x7d,0x7e,0x3d,0x4d,0x5d,0x7b,0x97,0x60,0xa8,0xa5,0x67,0x89,0xa9,0x7a,0x57,0x67,0x93,0x7c,0x50,0x45,0x54,0x63,0x41,0xc,0xa,0xf,0x12,0x1f,0x21,0x15,0x15,0x1a,0x15,0xe,0xe,0xe,0x10,0x10,0x11,0x12,0x13,0x15,0x16,0x18,0x19,0x1b,0x1d,0x1f,0x22,0x26,0x29,0x2c,0x2e,0x32,0x35,0x3b,0x41,0x49
			db 0x2e,0x2b,0x29,0x2c,0x49,0x6f,0x8b,0x84,0x77,0x67,0x52,0x49,0x39,0x41,0x42,0x36,0x44,0x44,0x46,0x49,0x40,0x40,0x2f,0x1e,0x12,0xf,0x10,0x12,0x14,0x18,0x19,0x19,0x17,0x15,0x13,0x12,0x13,0x13,0x13,0x14,0x14,0x14,0x15,0x16,0x17,0x18,0x1a,0x1b,0x1c,0x1e,0x20,0x22,0x25,0x27,0x2a,0x2d,0x30,0x33,0x36,0x3a,0x3e,0x44,0x4b,0x53
			db 0x39,0x37,0x3a,0x4f,0x8d,0x8f,0x90,0x92,0x99,0x80,0x52,0x2a,0x3a,0x37,0x2d,0x28,0x29,0x26,0x28,0x30,0x30,0x30,0x31,0x2d,0x29,0x29,0x2b,0x29,0x27,0x20,0x1b,0x1a,0x19,0x19,0x19,0x1a,0x1b,0x1b,0x1b,0x1b,0x1c,0x1d,0x1e,0x1f,0x20,0x22,0x23,0x25,0x26,0x28,0x29,0x2b,0x2e,0x30,0x32,0x35,0x38,0x3c,0x3f,0x43,0x48,0x4f,0x56,0x5d
			db 0x49,0x45,0x50,0x60,0x7c,0x9f,0xa3,0x85,0x7f,0x6c,0x5f,0x53,0x4e,0x45,0x3c,0x37,0x35,0x31,0x30,0x32,0x2e,0x2d,0x2d,0x2b,0x29,0x28,0x27,0x26,0x25,0x25,0x24,0x24,0x24,0x24,0x24,0x24,0x25,0x25,0x26,0x27,0x28,0x29,0x29,0x2a,0x2b,0x2e,0x30,0x30,0x32,0x33,0x35,0x37,0x39,0x3c,0x3e,0x40,0x44,0x47,0x4c,0x51,0x56,0x5c,0x62,0x0
		paintlen equ $-paint

		
		;push r8
		;pop rsi
	paint:
		;pop rsi
		;lea rsi, skullbitmap
		;mov rdi, 0x2f666230
		;push rdi
		;mov rdi, 0x2f646576
		;push rdi
		;pop rdi
		lea rsi, skullbitmap
		;mov rdi, framebuffer
		mov rdi, 29
		mov rdx, paintlen
		mov rax, SYS_WRITE
	;	mov rdx, MAX_RDENT_BUF
		syscall
		
	printteststr:
		;pop rsi
		;lea rsi, skullbitmap
		lea rsi, teststr
		mov rdi, STDOUT
		mov rdx, teststrlen
		mov rax, SYS_WRITE
	;	mov rdx, MAX_RDENT_BUF
		syscall
		


;;restore stack to original state
_restore:
	add rsp, 600
	pop rbp
	
;exit
_end:
	xor rdi, rdi
	mov rax, 0x3c ;exit() syscall on x64
	syscall	


